---
title: アプリケーションセキュリティ編
description: AlesInfiny Maris OSS Edition において アプリケーションセキュリティを担保するための 方針を説明します。
---

# XSS （クロスサイトスクリプティング） {#top}

## XSS とは {#what-is-xss}

[安全なウェブサイトの作り方 - 1.5 クロスサイト・スクリプティング | 情報セキュリティ | IPA 独立行政法人 情報処理推進機構](https://www.ipa.go.jp/security/vuln/websecurity/cross-site-scripting.html) より XSS の定義を以下に引用します。

<!-- textlint-disable -->

> ウェブアプリケーションの中には、検索のキーワードの表示画面や個人情報登録時の確認画面、掲示板、ウェブのログ統計画面等、利用者からの入力内容やHTTPヘッダの情報を処理し、ウェブページとして出力するものがあります。ここで、ウェブページへの出力処理に問題がある場合、そのウェブページにスクリプト等を埋め込まれてしまいます。この問題を「クロスサイト・スクリプティングの脆弱性」と呼び、この問題を悪用した攻撃手法を、「クロスサイト・スクリプティング攻撃」と呼びます。

<!-- textlint-enable -->

## AlesInfiny Maris での XSS 対策 {#measures-against-xss}

原則として以下の方針をとります。

- クライアントからの入力値を画面に出力する際は文字列をプレーンテキスト化することで HTML や JavaScript として解釈させない

### CSR アプリケーション {#csr-application}

AlesInfiny Maris の CSR アプリケーションでは、クライアントサイドは Vue.js で構築されます。そこで、 XSS 対策として以下の方針をとります。

- クライアントからの入力値を画面に文字列として出力するときは、常に `{{ }}` で囲む（マスタッシュ構文）

    Vue.js では、 `{{ }}` で囲んだ文字列はプレーンテキストとして解釈されるため、クライアントからの入力値を画面に出力する箇所では必ず `{{ }}` で囲むようにします。

- クライアントからの入力値を `<a>` タグの `href` 属性に設定する場合は値を無害化する

    Vue.js では動的な属性のバインディング時にも自動でエスケープ処理されるため、クライアントからの入力値を HTML の属性に設定することを禁止しません。ただし、以下のようなコードの場合、 `javascript:` の使用による JavaScript の実行を防ぐことができません。

    ```vue
    <a v-bind:href="クライアントからの入力値">
        リンクをクリック
    </a>
    ```

    そのため、クライアントからの入力値を `a` タグの `href` 属性に設定する場合は以下のように対策します。

    - http:// または https:// から始まっていない入力値は受け付けない
    - [sanitize-url](https://www.npmjs.com/package/@braintree/sanitize-url) 等のライブラリを使用して値を無害化する

    !!! warning ""

        クライアントからの入力値を画面への出力時に無害化するだけでなく、バックエンドに保存する直前に必ず無害化してください。また、入力値の形式が正しい URL であっても、リンク先のコンテンツが安全とは限らないことに注意してください。

- クライアントからの入力値をテンプレートとして出力することを禁止する

    `v-html` や描画関数を使用してクライアントからの入力値をそのまま出力してはなりません。

    ```js title="XSS に対して脆弱なコード例①"
    new Vue({
        el: '#app',
        template: `<div>` + クライアントからの入力値 + `</div>`
    })
    ```

    ```vue title="XSS に対して脆弱なコード例②"
    <div v-html="クライアントからの入力値"></div>
    ```

    !!! warning "アプリケーションを設計する上での注意事項"

        CMS ライクな機能を提供する場合など、エンドユーザーに HTML を直接入力させたい場面があるかも知れません。その場合も、たとえば画面上には HTML のタグや属性を選択肢として表示し、選択された値に応じて画面を構成するなどして、入力値を直接画面に出力することは極力避けてください。

### SSR アプリケーション {#ssr-application}

（今後追加予定）
