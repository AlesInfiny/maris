---
title: CSR 編
description: クライアントサイドレンダリングを行う Web アプリケーションのアーキテクチャについて解説します。
---

# 全体処理方式 {#top}

クライアントサイドレンダリング方式のアプリケーション全体で考慮すべきアーキテクチャについて、その実装方針を説明します。

## 例外処理方針 {#exception-policy}

## フロントエンドの例外処理 {#frontend-error-handling}

フロントエンドの例外処理方針は、ユーザーが自身で対応できるか、という観点が重要になります、
たとえば、セッションタイムアウトになるといったようなケースではユーザーが再度ログインすることで対処できます。
一方で、WebAPI サーバー内で予期しない問題が発生するといったケースでは、ユーザーは時間をおいて再度リクエストするなどのことしかできません。
このようにフロントエンドでは、ユーザーが例外を知りどのような対応をするか、ということに注目しメッセージの内容や通知方法を決定します。

## エラーハンドリング {#client-error-handling}

Vue.js アーキテクチャで例外が発生する箇所は以下のようなものが挙げられます。

- Vue コンポーネント
- Store
- WebAPI の応答
- その他

### クライアントコード内で発生する例外 {#client-code-error}

TypeScript で記述するコード(Store や共通部品)のハンドリングできる例外については、基本的に `try-catch` で処理します。
予期しないエラーについては、TypeScript の `window.onerror` や Vue.js の `Vue.config.errorHandler` のようなグローバルエラーハンドリングを利用します。

Vue コンポーネントで発生した例外は、ハンドリングしない場合、親コンポーネントへ例外が伝播し続けます。
ハンドリングできない例外については、最上位である main.ts のグローバルエラーハンドリングで処理されます。

### API 通信で発生する例外 {#api-connection-error}

API 通信で発生する例外についてはいくつかの段階に分けて処理します。なお API 通信には Axios を利用していることを前提としています。

1. HTTP ステータスコードの共通処理

   HTTP ステータスコード 500 番等に対して、 `axios.interceptors` を利用し、共通処理を実装します。

1. API レスポンスの業務例外に対する処理

    HTTP メソッドに対して `try-catch` で処理します。
    `then-catch` を用いた Promise の処理は、複雑になるとインデントの位置やネストによって可読性を損なうため推奨しません。

1. API レスポンスに対する画面処理

    ビュー・ビューモデルとモデルの責務を区別するため、 API 通信を含む(Store)メソッドに対して `try-catch` で処理します。
