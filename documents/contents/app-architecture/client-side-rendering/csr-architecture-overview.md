---
title: CSR 編
description: クライアントサイドレンダリングを行う Web アプリケーションのアーキテクチャについて解説します。
---

# CSR アーキテクチャ概要 {#top}

## 技術スタック {#tech-stack}

<!-- （フロントエンド、バックエンド含むスタック図） -->

利用ライブラリについては[フロントエンドアーキテクチャ](frontend-architecture.md)、バックエンドアーキテクチャ（後日追加予定）を参照してください。

## アプリケーションアーキテクチャ {#application-architecture}

AlesInfiny Maris OSS Edition のアプリケーションアーキテクチャは、クリーンアーキテクチャに基づいています。 アーキテクチャの全体概要は以下の通りです。

<!-- 図を入れる -->

<!-- ## フロントエンドの構造詳細 {#frontend-structure}

- ビュー
- ビューモデル
- モデル -->

## バックエンドの構造詳細 {#backend-structure}

クライアントサイドレンダリング方式の Web アプリケーションにおける、各層とそれを構成するコンポーネントの役割について、それぞれ説明します。

### アプリケーションコア層 {#application-core}

アプリケーションコア層は、ドメインモデルの定義と業務処理を実装する業務中心の層です。

- ドメインモデル

    ドメインモデルは、業務で扱うドメインをクラスとして表現するエンティティと値オブジェクトで構成するコンポーネントです。 共にモデルのデータ構造と振る舞いを持つことは変わりませんが、エンティティはプロパティが可変である一方、値オブジェクトのプロパティは不変です。
  
- ドメインサービス

    ドメインサービスは、エンティティや値オブジェクトに含めることが適当ではないドメイン固有の処理を実装するコンポーネントです。 ドメイン単位でクラスにまとめ、ドメインに対する処理毎にメソッドとして実装します。 必要に応じてリポジトリを利用して、データベースなどの外部リソースにアクセスします。 アプリケーションコア層のリポジトリインターフェースを利用し、インフラストラクチャ層のリポジトリ実装に依存しないよう注意してください。

- アプリケーションサービス

    アプリケーションサービスは、システムに必要な機能を実装するクラスです。 1 つの Web API の業務処理がアプリケーションサービスの 1 メソッドに対応します。 エンティティや値オブジェクト、リポジトリ ( インターフェース ) を組み合わせて、必要な機能を実現します。 必要に応じてドメインサービスも利用します。

- リポジトリインターフェース

    アプリケーションコア層のリポジトリはインターフェースであり、インフラストラクチャ層のリポジトリで実装されます。 依存関係逆転の法則に従い、アプリケーションコア層の実装がインフラストラクチャ層に依存しないようするためのインターフェースです。

### プレゼンテーション層 {#presentation}

プレゼンテーション層は、主にシステムの利用者とのやり取りを担う層です。 画面を構成するフロントエンドアプリケーションと、バックエンドアプリケーションのインターフェースとなる Web API を配置します。

- コントローラー
  
    コントローラーは ASP.NET Core のコントローラーに対応し、各 Web API の定義と実装を担います。 業務処理であるアプリケーションサービスを呼び出し、その結果からレスポンスデータを生成します。

- API モデル（ DTO 、ビューモデル）

    Web API のリクエスト／レスポンスの形式を定義するクラスです。 コントローラーが受け取る引数やレスポンスの型を C# のクラスで表現します。

### インフラストラクチャ層 {#infrastructure}

インフラストラクチャ層は、データベースを中心とする外部リソースにアクセスする処理を実現する層です。

- リポジトリ

    インフラストラクチャ層のリポジトリは、アプリケーションコア層のリポジトリインターフェースの実装クラスで、具体的なデータベースアクセス処理を実装します。 DbContext を介してデータベースとデータをやり取りします。

- DbContext(マイグレーション)

    DbContext はデータベース接続するためのクラスです。データベーススキーマをデータベース上に反映するため、 DbContext をもとにマイグレーションを生成します。マイグレーションもインフラストラクチャ層に配置します。
